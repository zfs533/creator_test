{"version":3,"sources":["assets/scene/scrollview/scrollview_v.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class ScrollView_v extends cc.Component {\n\n    @property(cc.Node)\n    item_v: cc.Node = undefined;\n\n    @property(cc.Node)\n    content_ver: cc.Node = undefined;\n\n    @property(cc.ScrollView)\n    scrollview_ver: cc.ScrollView = undefined;\n\n\n    private viewHeight: number = 0;\n    private contentOringinY: number = 0;\n    private count: number = 0;\n    private childNum_ver: number = 12;\n    private itemArr_ver: cc.Node[] = [];\n    private posArr_ver: cc.Vec2[] = [];\n\n    @property()\n    private length_ver: number = 100;\n    async start() {\n        await this.init();\n        this.setData_ver();\n\n    }\n\n    async init() {\n        return new Promise(async resolve => {\n            this.item_v.active = false;\n            this.viewHeight = this.content_ver.height;\n            this.contentOringinY = Math.floor(this.content_ver.y);\n            this.scrollview_ver.node.on(\"scrolling\", this.handleScroling_ver, this);\n            await this.initList_ver();\n            resolve();\n        });\n    }\n\n    async initList_ver() {\n        return new Promise(async resolve => {\n            if (this.content_ver.childrenCount < 1) {\n                let height = 0;\n                for (let i = 0; i < this.childNum_ver; i++) {\n                    let item = cc.instantiate(this.item_v);\n                    item.active = true;\n                    item.getChildByName(\"lb\").getComponent(cc.Label).string = i + \"\";\n                    height += item.height;\n                    let v2 = new cc.Vec2(0, -item.height / 2 - item.height * i);\n                    item.setPosition(v2);\n                    this.content_ver.addChild(item);\n                    this.itemArr_ver.push(item);\n                    this.resetContentSize_ver(height);\n                }\n            }\n\n            resolve();\n        });\n    }\n\n    resetContentSize_ver(height: number) {\n        if (height > this.viewHeight) {\n            this.content_ver.setContentSize(this.content_ver.width, height);\n        }\n    }\n\n    setData_ver() {\n        let height = 0;\n        let len: number = this.length_ver > 20 ? 20 : this.length_ver;\n        for (let i = 0; i < len; i++) {\n            height += this.item_v.height;\n            let v2 = new cc.Vec2(0, -this.item_v.height / 2 - this.item_v.height * i);\n            this.posArr_ver.push(v2);\n        }\n        this.resetContentSize_ver(height);\n        this.scheduleOnce(() => {\n            for (let i = len; i < this.length_ver; i++) {\n                height += this.item_v.height;\n                let v2 = new cc.Vec2(0, -this.item_v.height / 2 - this.item_v.height * i);\n                this.posArr_ver.push(v2);\n            }\n            this.resetContentSize_ver(height);\n        }, 1);\n    }\n\n    handleScroling_ver() {\n        if (this.itemArr_ver.length * this.item_v.height < this.viewHeight) { return; }\n        let contentY = Math.floor(this.content_ver.y);\n        let distance = contentY - this.contentOringinY;\n        let count = Math.floor(distance / this.item_v.height);\n        if (count < 0 || count + this.itemArr_ver.length > this.posArr_ver.length || count == this.count) {\n            return;\n        }\n        this.count = count;\n        for (let i = count; i < count + this.itemArr_ver.length; i++) {\n            let item = this.itemArr_ver[i - count];\n            item.getChildByName(\"lb\").getComponent(cc.Label).string = i + \"\";\n            item.y = this.posArr_ver[i].y;\n        }\n    }\n}\n"]}